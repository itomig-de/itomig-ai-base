{# AI Diagnostics Page Template #}

<h1>{{ 'Diagnostics:PageTitle'|dict_s }}</h1>

{# Save Alert (if present) #}
{% if oSaveAlert is defined %}
    {{ render_block(oSaveAlert, {aPage: oPage|default(null)}) }}
{% endif %}

{# Section 1: Configuration Status #}
{% if oConfigPanel is defined %}
    {{ render_block(oConfigPanel, {aPage: oPage|default(null)}) }}
{% endif %}

{# Section 2: Test Panel #}
{% if oTestPanel is defined %}
    {{ render_block(oTestPanel, {aPage: oPage|default(null)}) }}
{% endif %}

{# Section 3: Test Results #}
{% if oResultPanel is defined %}
    {{ render_block(oResultPanel, {aPage: oPage|default(null)}) }}
{% endif %}

{# Section 4: Error Display #}
{% if oErrorPanel is defined %}
    {{ render_block(oErrorPanel, {aPage: oPage|default(null)}) }}
{% endif %}

{# Section 5: Verbose Diagnostics #}
{% if oVerbosePanel is defined %}
    {{ render_block(oVerbosePanel, {aPage: oPage|default(null)}) }}
{% endif %}

{# Section 6: View Current Prompts #}
{% if oPromptsPanel is defined %}
    {{ render_block(oPromptsPanel, {aPage: oPage|default(null)}) }}
{% endif %}

{# Section 7: Edit Prompts #}
{% if oEditorPanel is defined %}
    {{ render_block(oEditorPanel, {aPage: oPage|default(null)}) }}
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function () {
    if (window.itomigDiagnosticsPanelsInitialized) {
        return;
    }
    window.itomigDiagnosticsPanelsInitialized = true;

    var aPanels = document.querySelectorAll('[data-role="ibo-panel"]');
    if (aPanels.length > 0) {
        aPanels[0].classList.remove('ibo-is-opened');
    }
    if (aPanels.length > 1) {
        aPanels[1].classList.add('ibo-is-opened');
    }

    document.querySelectorAll('[data-role="ibo-panel--collapsible-toggler"]').forEach(function (oToggler) {
        var oPanel = oToggler.closest('[data-role="ibo-panel"]');
        if (!oPanel) {
            return;
        }
        oToggler.addEventListener('click', function () {
            oPanel.classList.toggle('ibo-is-opened');
        });
    });
});
</script>
